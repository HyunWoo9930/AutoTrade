# 해외주식 USD 잔고 설정 가이드

## ⚠️ 문제: 예수금 $0.00

KIS 모의투자는 **국내주식**과 **해외주식** 계좌가 **분리**되어 있습니다.

```
국내주식 계좌: 1억원 (자동 지급)  ✅
해외주식 계좌: $0        (수동 입금 필요)  ❌
```

---

## ✅ 해결 방법 3가지

### 방법 1: KIS 모의투자 사이트에서 USD 입금 (권장) ⭐

#### 1단계: 모의투자 사이트 접속

https://mock.koreainvestment.com

#### 2단계: 로그인

- 앱키로 생성한 모의투자 계정
- 또는 한국투자증권 계정

#### 3단계: USD 입금

```
메뉴 위치:
  계좌관리 → 입출금 → 외화입금

입금 정보:
  - 통화: USD (달러)
  - 금액: $10,000 ~ $100,000
  - 목적: 해외주식 매매
```

#### 4단계: 입금 확인

```bash
python3 code/test_overseas_api.py
```

**성공 출력:**
```
💰 예수금: $10,000.00  ✅
```

---

### 방법 2: 코드에서 자동으로 기본값 사용 (현재 적용됨) ✅

**이미 적용되어 있습니다!**

코드가 자동으로 잔고 $0 감지 → $10,000 기본값 사용:

```python
# overseas_strategy.py
if cash_usd == 0:
    print(f"⚠️ 해외주식 계좌 잔고가 $0입니다. 기본값 $10,000 사용 (테스트 모드)")
    cash_usd = 10000
```

**장점:**
- 별도 설정 불필요
- 바로 테스트 가능

**단점:**
- 실제 주문은 실패 (계좌에 돈이 없으므로)
- 신호 분석만 가능

---

### 방법 3: 기본값 금액 변경

원하는 금액으로 변경 가능:

```python
# code/overseas_strategy.py 343번째 줄
if cash_usd == 0:
    cash_usd = 50000  # $10,000 → $50,000으로 변경
```

---

## 🧪 테스트 방법

### 1. 현재 USD 잔고 확인

```bash
python3 code/test_overseas_api.py
```

**출력 예시:**

```
🧪 해외주식 잔고 조회 테스트

✅ API 응답 성공!

📋 응답 키 목록: dict_keys(['ctx_area_fk200', 'ctx_area_nk200', 'output1', 'output2', ...])

💰 output2 타입: <class 'dict'>
💰 output2 키:
  - frcr_pchs_amt1: 0.00000          # 매수금액
  - frcr_buy_amt_smtl1: 0.00000      # 예수금 총액
  - ovrs_tot_pfls: 0.00000           # 총손익
```

### 2. 해외주식 전략 테스트

```bash
python3 code/test_overseas.py
```

**출력 예시:**

```
💰 계좌 상태:
  예수금: $0.00                      # API에서 조회된 실제 잔고
  보유수량: 0주

⚠️ 해외주식 계좌 잔고가 $0입니다. 기본값 $10,000 사용 (테스트 모드)

💰 계좌 상태 (보정):
  예수금: $10,000.00                 # 코드에서 자동으로 설정한 기본값

🎯 강한 매수 신호! (4/5)
💰 1차 매수: 2주 @ $175.43
  📌 지정가 주문 (현재가): $175.43
```

---

## 📊 모의투자 계좌 구조

```
┌─────────────────────────────────────┐
│   KIS 모의투자 계정                    │
├─────────────────────────────────────┤
│                                     │
│  ┌─────────────────────────────┐   │
│  │  국내주식 계좌               │   │
│  │  초기 자본: 100,000,000원   │   │
│  │  통화: KRW (원)             │   │
│  │  ✅ 자동 지급               │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  해외주식 계좌               │   │
│  │  초기 자본: $0              │   │
│  │  통화: USD (달러)           │   │
│  │  ❌ 수동 입금 필요          │   │
│  └─────────────────────────────┘   │
│                                     │
└─────────────────────────────────────┘
```

---

## 🔧 실전 매매를 위한 설정

### 1. USD 입금 완료 확인

```bash
python3 -c "
from kis_api import KISApi
api = KISApi()
api.get_access_token()
balance = api.get_overseas_balance()
print(f\"USD 잔고: {balance['output2']['frcr_buy_amt_smtl1']}\")
"
```

### 2. 기본값 설정 제거 (선택사항)

실제 잔고만 사용하려면 기본값 로직 제거:

```python
# code/overseas_strategy.py 342~345줄 주석 처리
# if cash_usd == 0:
#     print(f"⚠️ 해외주식 계좌 잔고가 $0입니다. 기본값 $10,000 사용 (테스트 모드)")
#     cash_usd = 10000
```

### 3. 최소 잔고 경고 추가 (선택사항)

```python
# code/overseas_strategy.py
MIN_USD_BALANCE = 1000  # 최소 $1,000

if cash_usd < MIN_USD_BALANCE:
    print(f"⚠️ USD 잔고 부족 (${cash_usd:.2f} < ${MIN_USD_BALANCE})")
    return
```

---

## 💡 권장 설정

### 테스트 단계
- 방법 2 사용 (기본값 $10,000)
- 신호 분석 및 로직 검증
- 실제 주문은 실행 안됨

### 실전 단계
- 방법 1 사용 (KIS 사이트에서 USD 입금)
- $10,000 ~ $100,000 입금
- 실제 모의 매매 가능

---

## ❓ FAQ

### Q1: 왜 국내주식은 1억원이 있는데 해외주식은 $0인가요?

**A:** KIS 모의투자 정책입니다. 국내주식은 자동으로 1억원이 지급되지만, 해외주식은 사용자가 직접 입금해야 합니다.

### Q2: 실제 돈을 입금하나요?

**A:** 아닙니다! 모의투자 계좌이므로 **가상 USD**를 입금하는 것입니다. 실제 돈은 들지 않습니다.

### Q3: 기본값 $10,000으로 실제 주문이 가능한가요?

**A:** 아닙니다. 신호 분석은 가능하지만, 실제 주문 시 KIS API에서 "잔고 부족" 오류가 발생합니다.

```
❌ 해외주식 매수 주문 실패: 주문가능금액을 초과하였습니다
```

### Q4: USD 입금 없이 테스트만 하고 싶어요.

**A:** 현재 코드 그대로 사용하시면 됩니다! 자동으로 기본값 $10,000이 설정되어 신호 분석, 포지션 사이징 등을 모두 테스트할 수 있습니다.

### Q5: 국내주식 자금을 해외주식으로 이동할 수 있나요?

**A:** 모의투자에서는 불가능합니다. KIS 사이트에서 해외주식 계좌에 직접 USD를 입금해야 합니다.

---

## 🎯 요약

| 방법 | 설정 | 신호분석 | 실제주문 | 권장 |
|-----|-----|---------|---------|------|
| **방법 1: KIS 사이트 USD 입금** | 필요 | ✅ | ✅ | 실전용 ⭐ |
| **방법 2: 코드 기본값 (현재)** | 불필요 | ✅ | ❌ | 테스트용 ✅ |
| **방법 3: 기본값 수정** | 간단 | ✅ | ❌ | 커스터마이징 |

**현재 상태:** 방법 2 적용됨 → **바로 테스트 가능!** 🚀

---

**작성일**: 2025-10-15
**버전**: 1.0.0
